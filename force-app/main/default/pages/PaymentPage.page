<!--
    Author : Jet R. Compayan
    Description : This payment form redirected from the membership sign up.
    Last Modified : 04 1, 2018
-->
<apex:page controller="AS_memberPayment" showHeader="false" sidebar="false" applyHtmlTag="false" applyBodyTag="false" docType="html-5.0">
    <html>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> </meta>
    <body>
        <header>
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" />
            <Style>
                html body {
                    background-repeat: no-repeat;
                    background-image: url("{!URLFOR($Resource.AS_membersignup_slice,"psa-member-signup-slices/pharmacybg.jpg")}");
                    background-attachment: fixed;
                    background-size:cover;
                    background-position: bottom;
                    font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
                    background-color: #eff7fa;
                    background-position-y: 198px;
                }

                .psa-payment-wrapper .psa-wrapper-box {
                    border-radius: 15px;
                    background-color: rgb(255, 255, 255);
                    box-shadow: 0px 7px 25.38px 1.62px rgba(0, 0, 0, 0.14);
                    margin: 50px auto;
                    width: 75.8%;
                    min-height: 766px;
                    padding-top: 42px;
                }

                .psa-payment-wrapper .psa-wrapper-box .psa-container {
                    margin: 1% auto;
                    width: 86%;
                }

                h4 {
                    color: #4c689a !important;
                }

                .psa-payment-wrapper .psa-logo {
                    text-align: right;
                }

                .psa-payment-wrapper .psa-logo img {
                    width: 45%;
                }

                .psa-title {
                    line-height: 40px;
                }

                .psa-order-lineitem {
                    -webkit-margin-before: 0;
                    -webkit-margin-after: 0;
                    -webkit-padding-start: 0;
                }

                .psa-header {
                    padding: 0%;
                }

                .psa-payment-wrapper p,
                .psa-payment-wrapper span {
                    font-size: 11px;
                }

                .psa-address-wrapper {
                    margin-top: 18px;
                    min-height: 130px;
                }

                .psa-payment-wrapper p,
                .psa-payment-wrapper span {
                    font-size: 11px;
                }

                .psa-p-title {
                    color: #dddddd;
                    border-bottom: 1px solid;
                    padding-bottom: 12px;
                }

                .psa-details-titles,
                .psa-payments-details {
                    width: 86%;
                }

                .psa-order-details {
                    width: 100%;
                }

                .pas-order-totals p {
                    margin-bottom: 5px;
                }

                .psa-order-amounts p {
                    text-align: right;
                    margin-right: 4px;
                }

                .pas-order-totals {
                    border-top: 1px solid #dddddd;
                    padding-top: 3%;
                }

                .nav-tabs .nav-item {
                    margin-bottom: 0px;
                    margin-left: 1%;
                }

                .nav-title {
                    margin-left: 0;
                }

                .nav-tabs .nav-item.show .nav-link,
                .nav-tabs .nav-link.active {
                    color: #5c6f7c;
                    background-color: #fff;
                    border-color: #fff #fff #5872a3;
                }

                .nav-link,
                .nav-title a {
                    display: block;
                    padding: .5em 1em;
                    font-size: 11px;
                }

                .psa-normal {
                    color: #5c6f7c;
                }

                .tite-payments {
                    color: #b1c1cc !important;
                }

                .psa-tumbnail {
                    width: 67%;
                    float: right;
                    margin-right: 12%;
                    margin-top: -5%;
                }

                .psa-add-dt {
                    line-height: 19px;
                }

                .psa-payments-details p {

                    font-weight: 600;
                    text-transform: uppercase;
                    color: #4c689a !important;
                    margin-bottom: 0%;

                }

                .psa-payments-detailss p,
                .psa-payments-details input {
                    font-size: 11px;
                }

                .psa-payment-order-details input,
                .psa-payment-order-details select {
                    border-color: #fff #fff #dddddd;
                    padding-left: 0%;
                    font-size: 13px;
                    border-radius: 0% !important;
                }

                .psa-payments-details .form-control:focus {
                    border-color: #fff #fff #5cb3fd;
                }

                .psa-payments-details input::placeholder {
                    color: #e0e0e0;
                }

                .psa-form--top {
                    margin-top: 4%;
                }

                .tite-payments {
                    color: #b1c1cc !important;
                    padding-left: 0% !important;
                }

                .span_req {
                    float: right;
                    color: #f00;
                    line-height: 15px;
                    font-size: 12px !important;
                }

                .psa-submit-btn,
                .psa-btn {
                    border-radius: 5px;
                    background-image: -moz-linear-gradient( 90deg, rgb(44, 85, 140) 0%, rgb(63, 98, 150) 100%);
                    background-image: -webkit-linear-gradient( 90deg, rgb(44, 85, 140) 0%, rgb(63, 98, 150) 100%);
                    background-image: -ms-linear-gradient( 90deg, rgb(44, 85, 140) 0%, rgb(63, 98, 150) 100%);
                    box-shadow: 0px 6px 16.92px 1.08px rgba(65, 107, 168, 0.8);
                    -webkit-border-radius: 5;
                    -moz-border-radius: 5;
                    -webkit-box-shadow: 0px 3px 13px #0336b8;
                    -moz-box-shadow: 0px 3px 13px #0336b8;
                    box-shadow: 0px 3px 13px #0336b8;
                    font-family: Arial;
                    color: #ffffff;
                    font-size: 11px;
                    padding: 11px;
                    text-decoration: none;
                    border: none !important;
                    width: 100%;
                }

                .psa-submit-btn:hover,
                .psa-btn:hover {
                    background: #365a8c !important;
                }
                .psa-submit-btn:hover{
                    cursor:pointer;
                }

                .psa-payment-order-details {
                    padding-bottom: 7%;
                }

                .psa-error-input {
                    border-bottom: 1px solid #ff0000 !important;
                }

                .psa-spinner-loading {
                    position: fixed;
                    border: 1px solid #FFB;
                    z-index: 999;
                    top: 0%;
                    background: #ffffff94;
                    bottom: 0%;
                    right: 0%;
                    left: 0%;
                }

                .psa-spinner-loading .psa-contiainer {
                    text-align: center;
                    position: fixed;
                    top: 44%;
                    left: 40%;
                    right: 40%;
                }

                .psa-spinner-loading .psa-contiainer img {
                    width: 20%;
                }

                #psa-close-error {
                    width: 3%;
                    float: right;
                    font-weight: 100;
                    border: 1px solid rgb(249, 239, 239);
                    text-align: center;
                    border-radius: 3px;
                    transition: border-color 1s ease;
                }

                #psa-close-error:hover {
                    border: 1px solid;
                    text-align: center;
                    border-radius: 3px;
                }

                #psa-submit-1[disabled],#psa-submit-2[disabled] {
                    background-color: #dcdcdc !important;
                    box-shadow: 6px 4px 20px 0px #d4d4d4;
                }
                
                #psa-submit-1{
                  margin-top: 9%;
                }
        
                .applyVoucher  {
                    width: 58px;
                    box-shadow: none;
                    border-radius: 1px 8px 8px 1px;
                    height: 37px;
                    margin-left: -2px; 
                }

                #voucherCodetxt {
                    border: 1px solid #3c6095;
                    padding: 8px;
                    width: 131px;
                }

                /* media Querries */
                @media  (max-width: 768px) {
                  .psa-payment-wrapper .psa-wrapper-box{
                    margin: 0px auto;
                    width: 100%;
                  }
                  .psa-payment-wrapper .psa-logo {
                    text-align: center;
                  }
                  .psa-payment-wrapper .psa-logo img {
                    width: 231px!important;
                  }
                  .psa-details-titles, .psa-payments-details {
                    width: 100%;
                  }
                }
/*
                @media only screen and (max-width: 1024px ) and (min-width: 768px )   {
                  .psa-details-titles, .psa-payments-details {
                    width: 86%;
                  }

                  .psa-payment-wrapper .psa-wrapper-box {
                      margin: 35px auto;
                      width: 94%;
                  }
                }*/

                 @media only screen and (min-device-width: 768px) and (max-device-width: 1366px) and (-webkit-min-device-pixel-ratio: 1.5) {
                    .psa-payment-wrapper .psa-wrapper-box{
                      margin: 0px auto;
                      width: 100%;
                    }
                    .psa-payment-wrapper .psa-logo { 
                      text-align: center; 
                    }
                    .psa-payment-wrapper .psa-logo img {
                      width: 231px!important;
                    }
                    .psa-details-titles, .psa-payments-details {
                      width: 100%;
                    }
                 }
            </Style>
        </header> 
        <div class="psa-payment-wrapper">
            <div class="psa-wrapper-box">

                <div class="psa-error-box" style="border: 1px solid rgb(248, 207, 207);border-radius: 2px;padding: 7px;background: rgb(249, 239, 239);width: 88%;margin: 0% auto;">
                    <p style="color: #f64040!important;"> <span id="psa-error-message-box"> An error occured while processing your transaction, please try again. </span> <span id="psa-close-error" style="float: right;font-weight: 100;">x</span></p>
                </div>
                <div class="psa-container container">
                    <div class="row clearfix">
                        <div class="psa-header col-md-6 ">
                            <h4 class="psa-title">Checkout</h4>
                        </div>
                        <div class="psa-header col-md-6 flex-first flex-md-unordered ">
                            <div class="psa-logo">
                                <apex:image url="{!URLFOR($Resource.AS_membersignup_slice,'psa-member-signup-slices/logo.png')}" />
                            </div>
                        </div>
                    </div>
                    <div class="row psa-address-wrapper">
                        <div class="col-md-6">
                            <div class="row clearfix">
                                <div class="psa-details-titles psa-address-details">
                                    <div class="psa-details-title">
                                        <p class="psa-p-title">Shipping Details</p>
                                    </div>
                                    <div class="psa-details-body">
                                        <p class="psa-normal psa-add-dt " id="psa-ship-to-details"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="row clearfix">
                                <div class="psa-details-titles psa-address-details" style="width: 418px;">
                                    <div class="psa-details-title">
                                        <p class="psa-p-title">Billing Details</p>
                                    </div>
                                    <div class="psa-details-body">
                                        <p class="psa-normal psa-add-dt " id="psa-bill-to-details"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row psa-payment-order-details">
                        <div class="col-md-6">
                            <div class="row clearfix">
                                <div class="psa-payments-details">
                                    <ul class="nav nav-tabs" role="tablist">
                                        <li class="nav-title">
                                            <a class="tite-payments">Payment Details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link psa-normal active" href="#creditcard" role="tab" data-toggle="tab">Credit Card</a>
                                        </li>
                                        <li class="nav-item" id="psa-debit-menu">
                                            <a class="nav-link psa-normal" href="#debitcard" role="tab" data-toggle="tab">Direct Debit</a>
                                        </li>
                                    </ul>
                                    <!-- Tab panes -->
                                    <div class="tab-content">
                                        <div class="tab-pane fade active show" id="creditcard" role="tabpanel" aria-expanded="true">
                                            <div class="form-group psa-form-details psa-form--top">
                                                <p for="psa-name-on-card">Name On Card <span class="span_req">•</span></p>
                                                <input type="text" class="form-control" id="psa-name-on-card" placeholder="Please type here" />
                                            </div>
                                            <div class="form-group psa-form-details">
                                                <p for="psa-card-type">Card Type <span class="span_req">•</span></p>
                                                <select name="cardtype" id="psa-card-type" placeholder="Please type here" class="form-control">
                                                  <option value=""></option>
                                                  <option value="American Express Card">American Express Card</option>
                                                  <option value="Diners Club">Diners Club</option>
                                                  <option value="Master Card">Master Card</option>
                                                  <option value="Visa Card">Visa Card</option>
                                                </select>
                                            </div>
                                            <div class="form-group psa-form-details">
                                                <p for="psa-card-number">Card Number <span class="span_req">•</span></p>
                                                <input type="text" class="form-control" id="psa-card-number" placeholder="Please type here" />
                                            </div>
                                            <div class="form-group psa-form-details">
                                                <div class="row">
                                                    <div class="col-md-8">
                                                        <p>Card Expiry (MONTH/YYYY)<span class="span_req">•</span></p>
                                                        <div class="row">
                                                            <div class="col-md-8">
                                                                <select name="Month" id="psa-month-card-expiry" class="form-control">
                                                                  <option value="01">January</option>
                                                                  <option value="02">February</option>
                                                                  <option value="03">March</option>
                                                                  <option value="04">April</option>
                                                                  <option value="05">May</option>
                                                                  <option value="06">June</option>
                                                                  <option value="07">July</option>
                                                                  <option value="08">August</option>
                                                                  <option value="09">September</option>
                                                                  <option value="10">October</option>
                                                                  <option value="11">November</option>
                                                                  <option value="12">December</option>
                                                                </select>
                                                            </div>
                                                            <div class="col">
                                                                <input type="text" class="form-control" id="psa-year-card-expiry" placeholder="YYYY" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <p>CVV <span class="span_req">•</span></p>
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" id="psa-ccv" placeholder="Type here" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group psa-form-details">
                                                 <!-- Ticket PSA-382 -->
                                                <!-- <div class="slds-form-element slds-grid  ">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-checkbox">
                                                            <input type="checkbox" class="credit-psa-iacknowledge" name="options" data-type="crd" id="checkbox-a1" value="on" />
                                                            <span class="span_req">•</span>
                                                            <span class="slds-form-element__label">I acknowledge that I have read the Terms and Conditions of the Direct Debit Request Service Agreement</span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="slds-form-element slds-grid ">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-checkbox">
                                                            <input type="checkbox" class="credit-psa-iconsent chk-iconsent" name="options" data-type="crd" id="checkbox-a2" value="on" />
                                                            <span class="span_req">•</span>
                                                            <span class="slds-form-element__label">I consent to give my signature via electronic means</span>
                                                        </span>
                                                    </div> 
                                                </div> -->
                                                <br />
                                                <button class="psa-submit-btn" id="psa-submit-2" data-pay-by="CreditCard">Purchase 517.50</button>
                                            </div>
                                            
                                        </div>
                                        <div role="tabpanel" class="tab-pane fade" id="debitcard">
                                            <div class="form-group psa-form-details psa-form--top">
                                                <p for="psa-bank-account-name">Bank Account Name<span class="span_req">•</span></p>
                                                <input type="text" class="form-control" id="psa-bank-account-name" placeholder="Please type here" />
                                            </div>
                                            <div class="form-group psa-form-details">
                                                <p for="psa-account-type">Account Type<span class="span_req">•</span></p>
                                                <select name="cardtype" id="psa-account-type" placeholder="Please type here" class="form-control">
                                                    <option value=""></option>
                                                    <option value="Individual">Individual</option>
                                                    <option value="Company">Company</option> 
                                                </select>
                                            </div>
                                            <div class="form-group psa-form-details">
                                                <p for="psa-card-number">Bank Account Number <span class="span_req">•</span></p>
                                                <input type="text" class="form-control" id="psa-account-number" placeholder="Please type here" />
                                            </div>
                                            <div class="form-group psa-form-details">
                                                <p for="psa-routing-number">BSB/Routing Number <span class="span_req">•</span></p>
                                                <input type="text" class="form-control" id="psa-routing-number" placeholder="Please type here" />
                                            </div>
                                            <div class="form-group psa-form-details">
                                                <div class="slds-form-element slds-grid  ">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-checkbox">
                                                            <input type="checkbox" class="psa-iacknowledge" name="options" data-type="dbt" id="checkbox-a1-dt" value="on" />
                                                            <span class="slds-form-element__label">I acknowledge that I have read the <a href="https://www.psa.org.au/about/terms-of-use/direct-debit-request/" target="_blank" > Terms and Conditions </a>  of the Direct Debit Request Service Agreement 
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="slds-form-element slds-grid ">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-checkbox">
                                                            <input type="checkbox" class="psa-iconsent chk-iconsent" name="options" data-type="dbt" id="checkbox-a2-dt" value="on" />
                                                            <span class="slds-form-element__label">I consent to give my signature via electronic means</span>
                                                        </span>
                                                    </div>
                                                </div>
                                                <button class="psa-submit-btn" id="psa-submit-1" data-pay-by="DirectDebit">Purchase 0.00</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 flex-first flex-md-unordered ">
                            <div class="row clearfix">
                                <div class="psa-order-details">
                                    <div class="psa-details-title">
                                        <p class="psa-p-title">Your Order</p>
                                    </div>
                                    <div class="psa-order-details">
                                        <div id="psa-order-body">
                                        </div>
                                        <div class="pas-order-totals">
                                            <div class="row clearfix">
                                                <div class="col-sm-6">
                                                    <p class="psa-normal">Coupon Code</p>
                                                </div>
                                                <div class="col-sm-6 text-right">
                                                     <input type="text" id="voucherCodetxt"/><button class="applyVoucher psa-btn ">Apply</button>
                                                </div>
                                            </div>
                                            <div class="row clearfix">
                                                <div class="col-md-6">
                                                    <p class="psa-normal">Subtotal</p>
                                                </div>
                                                <div class="col-md-6 psa-order-amounts">
                                                    <p class="psa-normal" id="psa-order-subtotal"></p>
                                                </div>
                                            </div>
               
                                            <div class="row clearfix">
                                                <div class="col-md-6">
                                                    <p class="psa-normal">GST</p>
                                                </div>
                                                <div class="col-md-6 psa-order-amounts">
                                                    <p class="psa-normal" id="psa-order-discount"></p>
                                                </div>
                                            </div>
                                            <div class="row clearfix">
                                                <div class="col-md-6">
                                                    <p class="psa-normal">Total</p>
                                                </div>
                                                <div class="col-md-6 psa-order-amounts">
                                                    <p class="psa-normal" id="psa-order-total"></p>
                                                </div>
                                            </div>
                                            <div class="row clearfix instalment-wrapper">
                                                <div class="col-md-6">
                                                    <p class="psa-normal">Instalment Payment</p>
                                                </div>
                                                <div class="col-md-6 psa-order-amounts">
                                                    <p class="psa-normal" id="psa-order-perpayment"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="psa-spinner" class="psa-spinner-loading">
            <div class="psa-contiainer">
                <apex:image id="theImage" value="{! URLFOR($Resource.AS_slds,'assets/images/spinners/slds_spinner_brand.gif') }" alt="Loading..." />
                <p class="psa-loading-message">Processing payment, may take up to 1 minute. Please do not refresh the page or click on the back button</p>
            </div>
        </div>
    </body>
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
    <apex:includeScript value="{!URLFOR($Resource.almond_uilib, '/js/jquery.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.almond_uilib, '/js/almondutils.min.js')}"/>
    <c:PaymentControllerJS />
    <script type="text/javascript">
        AS_jquery = jQuery.noConflict();

        AS_jquery(function($) {
            /*init Class*/
            var pc = new AS_PaymentController();
            //pc.initTaost();
            var os = pc.Object_Session;
            var isCloseWon = false;
            var productionObj = [];
            var isShowDebitTab = false;
            var opportunityProductFamily;

            $('#psa-spinner').hide();
            $('.psa-error-box').hide();

            if (pc.getUrlVar('directdebit') == '0') {
                $('#debitcard').remove();
                $('#psa-debit-menu').remove();
            }

            //training page url
            var TrainingUrl = '';
            if (pc.getUrlVar('tPlanId').trim() != '') {
                TrainingUrl = '{!$Page.TrainingPlanPreview}?id=' + pc.getUrlVar('tPlanId');
            }
            var init = function() {
                productionObj = [];
                /*All Records*/
                pc.getAllRecords(

                    /*isFound*/
                    function(isFound) {

                        if (pc.isEmpty(isFound)) {

                            $('.psa-error-box').fadeIn(1000);
                            $('#psa-error-message-box').html('Oops! Sorry no Opportunity found.');
                            $('.psa-container').remove();

                        } else if (isFound.theOpportunityLineItem.length == 0) {

                            $('.psa-error-box').fadeIn(1000);
                            $('#psa-error-message-box').html('Oops! Sorry Products is required to proceed.');
                            $('.psa-container').remove();

                        } else {
                            os.PRICEBOOKID = isFound.thePricebook;
                            console.log("rest==>", isFound);
                            isShowDebitTab = isFound.showTTrackDirectDebit;
                            if (isFound.theOpportunity.StageName == 'Closed Won') {
                                isCloseWon = true;
                            }
                        }

                    },

                    /*AccountDetails*/
                    function(AccountDetails, isFound) {

                        var ad = AccountDetails;
                        os.ACCOUNTID = ad.Id;



                        /*Ship to elements*/
                        var shipTo_tag = ad.Name + '<br/>' +
                            '' + (typeof ad.ShippingStreet !== 'undefined' ? ad.ShippingStreet : '') + ' <br/>' + (typeof ad.ShippingCity !== 'undefined' ? ad.ShippingCity : '') + ' ' + (typeof ad.ShippingState !== 'undefined' ? ad.ShippingState : '') + ' ' + (typeof ad.ShippingPostalCode !== 'undefined' ? ad.ShippingPostalCode : '') + ' <br/> ' + (typeof ad.ShippingCountry !== 'undefined' ? ad.ShippingCountry : '');


                        /*Bill to elements*/
                        var billTo_tag = ad.Name + '<br/>' +
                            '' + (typeof ad.BillingStreet !== 'undefined' ? ad.BillingStreet : '') + ' <br/>' + (typeof ad.BillingCity !== 'undefined' ? ad.BillingCity : '') + ' ' + (typeof ad.BillingState !== 'undefined' ? ad.BillingState : '') + ' ' + (typeof ad.BillingPostalCode !== 'undefined' ? ad.BillingPostalCode : '') + ' <br/>' + (typeof ad.BillingCountry !== 'undefined' ? ad.BillingCountry : '');

                        /*Append Elements*/
                        $('#psa-ship-to-details').html(shipTo_tag);
                        $('#psa-bill-to-details').html(billTo_tag);

                    },

                    /*Opportunity Details*/
                    function(OppurtunityDetails, isFound) {

                        console.log(OppurtunityDetails);

                        if (!pc.isEmpty(isFound)) {

                            var html = '';
                            var subTotal = 0;
                            var Total = 0;

                            var hideIstallment = false;
                            opportunityProductFamily = OppurtunityDetails.AS_Product__r.Family;


                            os.OPPORTUNITYID = OppurtunityDetails.Id;

                            var frequency = 1;
                            if (OppurtunityDetails.Pricebook2.AS_X6_Month_Subscription__c) {
                                frequency = 6;
                            } else if (typeof(OppurtunityDetails.Pricebook2.AS_Frequency__c) !== 'undefined') {
                                frequency = OppurtunityDetails.Pricebook2.AS_Frequency__c;
                            }


                            OppurtunityDetails.OpportunityLineItems.forEach(function(item) {

                                var freqWord = '';
                                if (frequency == 1) {
                                    freqWord = 'Yearly';
                                    hideIstallment = true;
                                } else if (frequency == 2) {
                                    freqWord = 'Every Six Months';
                                } else if (frequency == 4) {
                                    freqWord = 'Quarterly';
                                } else if (frequency == 12 || frequency == 6) {
                                    freqWord = 'Monthly';
                                }

                                var urlimage = "{!URLFOR($Resource.AS_membersignup_slice,'psa-member-signup-slices/thumbnail.png')}";
                                html += '<div class="row clearfix">' +
                                    '<div class="col-md-6 col-xs-12">' +
                                    '<div class="row clearfix">' +
                                    '<div class="col-xs-2">' +
                                    '<img src="' + urlimage + '" class="psa-tumbnail" />' +
                                    '</div>' +
                                    '<div class="col-xs-10">' +
                                    '<p class="psa-normal">' + item.Product2.Name + '<br/> <span>' + freqWord + ' Payment</span> </p>' +
                                    '</div>' +
                                    '</div>' +
                                    '</div>' +
                                    '<div class="col col-xs-2  psa-order-quantity"   style="padding-left: 3%!important;">' +
                                    '<span class="psa-normal" > ' + item.Quantity + ' </span>' +
                                    '</div>' +
                                    '<div class="col col-xs-2  ">' +
                                    '<span class="psa-normal"> ' + pc.convertToCurrency(item.UnitPrice, "$") + ' </span>' +
                                    '</div>' +
                                    '<div class="col col-xs-2  ">' +
                                    '<span class="psa-normal"> ' + pc.convertToCurrency((item.UnitPrice * item.Quantity), "$") + ' </span>' +
                                    '</div></div>';
                                /*sum up all the amount*/
                                subTotal += (item.UnitPrice * item.Quantity);
                                console.log(item.Description);
                                if (typeof item.Description !== 'undefined') {
                                    productionObj[item.Description] = true;
                                }

                            });

                            var toalDisplay = 0;

                            /*calculations*/
                            os.SUBTOTAL = subTotal;
                            os.TOTAL = OppurtunityDetails.AS_Invoiced_Amount__c;

                            /*Append Elements*/
                            $('#psa-order-body').html(html);
                            $('#psa-order-subtotal').text(pc.convertToCurrency(os.SUBTOTAL, '$'));
                            $('#psa-order-discount ').text(pc.convertToCurrency(OppurtunityDetails.AS_GST_Component__c, '$'));
                            $('#psa-order-total ').text(pc.convertToCurrency(os.TOTAL, '$'));

                            console.log("isShowDebitTab =>", isShowDebitTab);
                            if (!isShowDebitTab) {

                                if (hideIstallment) {

                                    $('.instalment-wrapper').hide();
                                    $('#debitcard').remove();
                                    $('#psa-debit-menu').remove();
                                } else {
                                    console.log("hello");
                                    $('#psa-order-perpayment ').text(pc.convertToCurrency((os.TOTAL / frequency), '$'));
                                }
                            } else {

                                if (!hideIstallment) {
                                    $('#psa-order-perpayment ').text(pc.convertToCurrency((os.TOTAL / frequency), '$'));
                                }
                            }




                            /*$('.psa-submit-btn').text('Purchase  ' + pc.convertToCurrency(os.TOTAL, '$'));*/
                            /*Label was changed from Purchase $XXX.XX to Complete Purchase. PSA-128*/


                            /*   if(isCloseWon) {
                                    $('.psa-submit-btn').text('Complete Once off Payment');
                            } else {*/
                            $('.psa-submit-btn').text('Complete Purchase');
                            //  }

                        }

                    }
                );

            }
            init();


            // $('#psa-submit-2').prop('disabled', true); // - Ticket PSA-382
            // $('#psa-submit-1').prop('disabled', true);
            $('.chk-iconsent').change(function() {

                if ($(this).is(':checked')) {
                    // - Ticket PSA-382
                    // if ($(this).attr('data-type') == 'crd' && ($('#checkbox-a1').is(':checked') && $('#checkbox-a2').is(':checked'))) { 
                    //     $('#psa-submit-2').prop('disabled', false);
                    // }

                    // if ($(this).attr('data-type') == 'dbt' && ($('#checkbox-a1-dt').is(':checked') && $('#checkbox-a2-dt').is(':checked'))) {
                    //     $('#psa-submit-1').prop('disabled', false);
                    // }

                } else {
                    // - Ticket PSA-382
                    // if ($(this).attr('data-type') == 'crd') {
                    //     $('#psa-submit-2').prop('disabled', true);
                    // }
                    // if ($(this).attr('data-type') == 'dbt') {
                    //     $('#psa-submit-1').prop('disabled', true);
                    // } 
                }

            });


            var intervalId = null;
            $('.psa-submit-btn').click(function() {
                var isRequired = false;

                var message = '<span>Error: You must enter a value.</span>';
                $('.psa-error-message').html('');
                $('.form-control').removeClass('psa-error-input');
                os.PAYBY = $(this).attr('data-pay-by');
                os.ONCEOFF = isCloseWon;
                console.log("hello world 1");
                if (os.PAYBY == "CreditCard") {

                    var name_on_card = $('#psa-name-on-card').val();
                    var card_type = $('#psa-card-type').val();
                    var card_number = $('#psa-card-number').val();
                    var month = $('#psa-month-card-expiry').val();
                    var year = $('#psa-year-card-expiry').val();
                    var cvv = $('#psa-ccv').val();

                    /* code below added for ticket (#PSA-329) starts here */
                    // if ($('.credit-psa-iacknowledge').is(':checked')) {
                    //  os.ACKNOWLEDGEDBRQSTSRVC = true;
                    // } else {
                    //  isRequired = true;
                    // }

                    // if ($('.credit-psa-iconsent').is(':checked')) {
                    //  os.CONSENTTOGIVESGNTR =  true;
                    // } else {
                    //  isRequired = true;
                    // }
                    /* code below added for ticket (#PSA-329) ends here */

                    if (pc.isEmpty(name_on_card)) {
                        isRequired = true;
                        $('#psa-name-on-card').addClass('psa-error-input');
                    }
                    if (pc.isEmpty(card_number)) {
                        isRequired = true;
                        $('#psa-card-number').addClass('psa-error-input');
                    }
                    if (pc.isEmpty(month)) {
                        isRequired = true;
                        $('#psa-month-card-expiry').addClass('psa-error-input');
                    }
                    if (pc.isEmpty(year)) {
                        isRequired = true;
                        $('#psa-year-card-expiry').addClass('psa-error-input');
                    }
                    if (pc.isEmpty(cvv)) {
                        isRequired = true;
                        $('#psa-ccv').addClass('psa-error-input');
                    }
                    if (pc.isEmpty(card_type)) {
                        isRequired = true;
                        $('#psa-card-type').addClass('psa-error-input');
                    }



                    os.ACCOUNTDETAILS = new os.AccountDetailsConstructor({
                        Account_Name: "",
                        Account_Type: "",
                        Account_Number: "",
                        Account_Routing_Number: "",
                        First_Payment_Date: ""
                    });

                    if (!isRequired) {

                        os.CARDDETAILS = new os.CardDetailsConstructor({
                            Name_On_Card: name_on_card,
                            Card_Type: card_type,
                            Card_Number: card_number,
                            Card_Expiry_Month: month,
                            Card_Expiry_Year: year,
                            CCV: cvv
                        });
                    }

                } else if (os.PAYBY == "DirectDebit") {


                    var Account_Name = $('#psa-bank-account-name').val();
                    var Account_Type = $('#psa-account-type').val();
                    var Account_Number = $('#psa-account-number').val();
                    var Account_Routing_Number = $('#psa-routing-number').val();


                    if (pc.isEmpty(Account_Name)) {
                        isRequired = true;
                        $('#psa-bank-account-name').addClass('psa-error-input');
                    }

                    if (pc.isEmpty(Account_Type)) {
                        $('#psa-account-type').addClass('psa-error-input');
                    }

                    if (pc.isEmpty(Account_Number)) {
                        isRequired = true;
                        $('#psa-account-number').addClass('psa-error-input');
                    }

                    if (pc.isEmpty(Account_Routing_Number)) {
                        isRequired = true;
                        $('#psa-routing-number').addClass('psa-error-input');
                    }

                    // +Ticket PSA-382
                    var isShowTermMessage = false;
                    if (!$("#checkbox-a1-dt").is(':checked')) {
                        isRequired = true;
                        isShowTermMessage = true;
                    }

                    // +Ticket PSA-382
                    if (!$("#checkbox-a2-dt").is(':checked')) {
                        isRequired = true;
                        isShowTermMessage = true;
                    }


                    // +Ticket PSA-382
                    if (isShowTermMessage) {
                        $('#psa-spinner').hide();
                        $('html, body').animate({
                            scrollTop: 0
                        }, 'slow');
                        $('.psa-error-box').fadeIn(1000);
                        $('#psa-error-message-box').html('Please tick the boxes to acknowledge your consent to the Terms and Conditions and electronic signature for Direct Debit payments.');
                    }

                    os.CARDDETAILS = new os.CardDetailsConstructor({
                        Name_On_Card: "",
                        Card_Type: "",
                        Card_Number: "",
                        Card_Expiry_Month: "",
                        Card_Expiry_Year: "",
                        CCV: ""
                    });


                    if (!isRequired) {

                        os.ACCOUNTDETAILS = new os.AccountDetailsConstructor({
                            Account_Name: Account_Name,
                            Account_Type: Account_Type,
                            Account_Number: Account_Number,
                            Account_Routing_Number: Account_Routing_Number,
                            First_Payment_Date: ''
                        });
                    }



                }

                console.log("isRequired ", isRequired);

                if (!isRequired) {
                    //  console.log('os==> ', os);
                    var result = JSON.stringify(os);

                    $('#psa-spinner').show();

                    pc.submitAllData(result,
                        function(params, OppurtunityDetails) {
                            var res = OppurtunityDetails;

                            if (res.status == 'ERROR') {

                                $('html, body').animate({
                                    scrollTop: 0
                                }, 'slow');
                                $('.psa-error-box').fadeIn(1000);
                                $('#psa-error-message-box').html(res.message);
                                $('#psa-spinner').hide();


                            }
                            if (res.status == 'SUCCESS') {

                                if (os.PAYBY == "DirectDebit") {
                                    $('#psa-spinner').show();
                                    $('.psa-loading-message').text('Processing Data.');
                                    location.replace("https://www.psa.org.au/payment/");

                                } else if (os.PAYBY == "CreditCard") {
                                    intervalId = setInterval(checkingInterval, 5000);

                                }
                            }
                        }
                    );

                }
            });

            var attemp = 0;
            var checkingInterval = function() {

                pc.checkStatusPayment(function(paymentStatus) {

                    console.log(paymentStatus);

                    if (attemp != 15) {

                        if (opportunityProductFamily != 'Membership') {
                            if (typeof paymentStatus.ChargentOrders__Response_Status__c !== 'undefined') {
                                console.log('approved transaction found: ' + paymentStatus.Name);

                                setTimeout(function() {

                                    pc.queueForProcessing(function(callBack) {
                                        clearInterval(intervalId);
                                        window.parent.location = 'https://www.psa.org.au/payment/';
                                    });
                                });
                            } else if (paymentStatus.ChargentOrders__Response_Status__c == 'Error') {

                                clearInterval(intervalId);
                                $('#psa-spinner').hide();
                                $('html, body').animate({
                                    scrollTop: 0
                                }, 'slow');
                                $('.psa-error-box').fadeIn(1000);


                                $('#psa-error-message-box').html('We\'re sorry. An error occured during payment processing.');
                            }
                        } else {
                            if (typeof paymentStatus.ASPHPP__Payment_Status__c !== 'undefined') {

                                if (paymentStatus.ASPHPP__Payment_Status__c == 'Success') {
                                    setTimeout(function() {

                                        if (!isCloseWon) { // for (#PSA-330)

                                            //pc.convertToCloseWon(paymentStatus.ASPHPP__PSubscription__r.ASPHPP__Payment_Source__c,
                                            pc.convertToCloseWon(function(callBack) {
                                                console.log(' Success heading to convert to Close won in 5 seconds... ');
                                                clearInterval(intervalId);

                                                window.parent.location = 'https://www.psa.org.au/payment/';
                                            });
                                        } else {
                                            var onceOffParam = [];
                                            onceOffParam[0] = paymentStatus.ASPHPP__PSubscription__r.AS_opportunity__c;
                                            onceOffParam[1] = paymentStatus.ASPHPP__PSubscription__r.ASPHPP__Payment_Source__c;
                                            onceOffParam[2] = paymentStatus.ASPHPP__PSubscription__c;
                                            onceOffParam[3] = paymentStatus.Id;

                                            pc.successOnceOff(onceOffParam, function(callBack) {
                                                console.log(' Success onceOff process... ');
                                                clearInterval(intervalId);

                                                window.parent.location = 'https://www.psa.org.au/payment/';

                                            });
                                        }

                                    }, 5000);

                                } else {

                                    clearInterval(intervalId);
                                    $('#psa-spinner').hide();
                                    $('html, body').animate({
                                        scrollTop: 0
                                    }, 'slow');
                                    $('.psa-error-box').fadeIn(1000);


                                    $('#psa-error-message-box').html('We\'re sorry. An error occured during payment processing.');

                                    /*if( typeof paymentStatus.ASPHPP__PSubscription__c != 'undefined' ||  paymentStatus.ASPHPP__PSubscription__c == '' || paymentStatus.ASPHPP__PSubscription__c == null )
                                    {
                                        pc.convertToSubEndDate(  paymentStatus.ASPHPP__PSubscription__c  , function( callback ){
                                            console.log( callback );
                                        });
                                    }*/
                                }

                            } else {

                                console.log(attemp + '.checking status for another attemp...');
                                attemp += 1;

                            }

                        }

                    } else {

                        clearInterval(intervalId);
                        $('#psa-spinner').hide();
                        $('html, body').animate({
                            scrollTop: 0
                        }, 'slow');
                        $('.psa-error-box').fadeIn(1000);
                        $('#psa-error-message-box').html('This payment takes too long to respond.');


                        /*if( typeof paymentStatus.ASPHPP__PSubscription__c != 'undefined' ||  paymentStatus.ASPHPP__PSubscription__c == '' || paymentStatus.ASPHPP__PSubscription__c == null ){
                            pc.convertToSubEndDate(  paymentStatus.ASPHPP__PSubscription__c  , function( callback ){
                                console.log( callback );
                            });
                        }*/

                    }

                });

            };

            $('#psa-close-error').click(function() {
                $('.psa-error-box').fadeOut(1000);
            });

            $('.applyVoucher').click(function() {
                var couponParam = [];
                couponParam[0] = os.PRICEBOOKID;
                couponParam[1] = $('#voucherCodetxt').val();
                if (!productionObj[$('#voucherCodetxt').val()]) {
                    pc.addVoucher(couponParam, function(res) {
                        if (res) {
                            init();

                            $('#voucherCodetxt').val('');
                        } else {
                            $('#psa-spinner').hide();
                            $('html, body').animate({
                                scrollTop: 0
                            }, 'slow');
                            $('.psa-error-box').fadeIn(1000);
                            $('#psa-error-message-box').html('Invalid Voucher Code.');
                        }
                    });
                } else {
                    $('#psa-spinner').hide();
                    $('html, body').animate({
                        scrollTop: 0
                    }, 'slow');
                    $('.psa-error-box').fadeIn(1000);
                    $('#psa-error-message-box').html('This Code "' + $('#voucherCodetxt').val() + '" is already in used.');
                }

            });
        });
    </script>
 
    </html>
</apex:page>